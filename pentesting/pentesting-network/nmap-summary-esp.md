# Nmap Summary (ESP)

<<<<<<< HEAD
```
nmap -sV -sC -O -n -oA nmapscan 192.168.0.1/24
```

&#x20;**-iL** lista\_IPs

**-iR** numero --> N√∫mero de Ips aleatorias, se pueden excluir posibles Ips con **--exclude \<Ips>** o **--excludefile \<fichero>**

**Descubrimiento de equipos:**

Podemos usar m√°scaras/24

**-sL**: No es invasivo, lista los objetivos realizando peticiones de DNS para resolver nombres. Sirve para saber si por ejemplo www.prueba.es/24 todas las Ips son objetivos nuestros.

Por defecto Nmap lanza una fase de descubrimiento que consta de: -PA80 -PS443 -PE -PP

**-Pn** No ping --> √∫til **si se sabe que todos est√°n activos** (sino lo estuviera alguno se podr√≠a perder mucho tiempo, pero tambi√©n saca falsos negativos esta opci√≥n diciendo que no esta activo), impide la fase de descubirmiento

**-sn** No port scan: Tras completar fase de reconocimiento **no analiza puertos.** Es relativamente sigilosa, y permite un peque√±o reconocimiento de la red. Con privilegios env√≠a un ACK (-PA) al 80, un SYN(-PS) al 443 y un echo request y un Timestamp request, sin privilegios siempre completa conexiones. Si el objetivo es de la red, solo usa ARP(-PR). Si se usa con otra opci√≥n solo se lanzan los paquetes de la otra opci√≥n.

**-PR** Ping ARP: Se usa por defecto cuando se analizan equipos de nuestra red, es m√°s r√°pido que usar pings. Si no se quiere usar paquetes ARP hay que usar --send-ip.

**-PS\<puertos>** SYN: env√≠a paquetes de SYN a los que si responde SYN/ACK es que esta abierto(al que se reponde con RST para no acabar la conexi√≥n), si responde RST esta cerrado y si no responde es inalcanzable. En caso de no tener privilegios autom√°ticamente se usa una conexi√≥n total. Si no se dan puertos, lo lanza al 80.

**-PA\<puertos>** ACK: Como la anterior pero con ACK, combinando ambas se obtienen mejores resultados.

**-PU\<puertos>** UDP: El objetivo es el contrario, se env√≠an a puertos que se espera que est√©n cerrados. Algunos firewall solo revisan conexiones TCP. Si est√° cerrado se responde con port unreachable, si se responde con otro icmp o no se responde se deja como destino inalcanzable.

**-PE, -PP, -PM** PINGS ICMP:echo replay, timestamp y addresmask. Se lanzan para descubrir si el objetivo esta activo

**-PY\<puertos>** SCTP: Env√≠a sondas SCTP INIT al 80 por defecto, se puede responder INIT-ACK(abierto) o ABORT(cerrado) o nada o ICMP inalcanzable(inactivo)

\-**PO\<protocolos>:** Se indica un protocolo en las cabeceras, por defecto 1(ICMP), 2(IGMP) y 4(Encap IP). Para los protocolos ICMP, IGMP, TCP (6) Y UDP (17) se env√≠an las cabeceras del protocolo, para el resto solo se env√≠a la cabecera IP. EL objetivo de esto es que por la malformaci√≥n de las cabeceras, se responda Protocolo inalcanzable o respuestas del mismo protocolo para saber si est√° levantado.

**-n** No DNS

**-R** DNS siempre

**T√©cnicas de escaneo de puertos:**

**-sS** --> No completa la conexi√≥n por lo que no deja rastro, muy buena si se puede usar. (privilegios) Es la que se usa por defecto

**-sT** --> Completa la conexi√≥n, por lo que s√≠ que deja rastro, pero seguro que se puede usar. Por defecto sin privilegios.

**-sU** --> M√°s lenta, para UDP. Ppalmente: DNS(53), SNMP(161,162), DHCP(67 y 68), (-sU53,161,162,67,68): abierto(respuesta), cerrado(puerto inalcanzable), filtrado (otro ICMP), abierto/filtrado (nada). En caso de tener abierto/filtrado, -sV env√≠a numerosas peticiones para detectar alguna de las versiones que nmap soporta pudiendo detectar el aut√©ntico estado. Aumenta mucho el tiempo.

**-sY** --> Protocolo SCTP no llega a establecer la conexi√≥n, por lo que no hay registros, funciona como -PY

**-sN,-sX,-sF** --> Null, Fin, Xmas, sirven pueden penetrar algunos firewall y sacar informaci√≥n. Se basan en que los equipos que cumplan el est√°ndar deber√°n responder con RST todas las peticiones que no tengan levantadas los lags de SYN, RST o ACK: abierto/filtrado(nada), cerrados(RST), filtrado (ICMP inalcanzable). No fiable en WIndows, CIsco, BSDI y OS/400. En unix s√≠.

**-sM Maimon scan:** Env√≠a flags FIN y ACK, usado para BSD, actualmente devolver√° todo como cerrado.

**-sA, sW** --> ACK y Window, sirve para detectar firewalls, para saber si los puertos est√°n filtrados o no. El -sW s√≠ distingue entre abiertos/cerrados ya que los abiertos responden con un valor de window distinto: abiertos(RST con ventana distinto de 0), cerrado (RST ventana = 0), filtrado (ICMP inalcanzable o nada). No todos los equipos funcionan as√≠, as√≠ que si sale todo cerrado, es que no funciona, si salen unos pocos abiertos es que funciona bien, y si salen muchos abiertos y pocos cerrados, es que funciona al rev√©s.

**-sI Idle scan** --> Para los casos en los que hay un firewall activo pero que sabemos que este no filtra a una determinada Ip (o cuando queremos simplemente anonimato) podemos usar el esc√°ner zombie (sirve para todos los puertos), para buscar posibles zombies podemos usar el scrpit ipidseq o el exploit auxiliary/scanner/ip/ipidseq. Este escaner se basa en el n√∫mero IPID de los paquetes IP

**--badsum -->** Env√≠an la suma mal, los equipos descartar√≠an los paquetes, pero los firewall podr√≠an responder algo, sirve para detectar firewalls

**-sZ** --> Escaner ‚Äúraro‚Äù de SCTP, al enviar sondas con fragmentos cookie echo deben ser eliminadas si esta abierto o respondidas con ABORT si cerrado. Puede traspasar firewalls que no traspasa el init, lo malo es que no distingue entre filtrado y abierto.

**-sO** --> Protocol Ip scan: Env√≠a cabeceras mal y vac√≠as en las que a veces no se distingue ni el protocolo. Si llega ICMP unreachable protocol esta cerrado, si llega unreachable port esta abierto, si llega otro error, filtrado, si no llega nada, abierto|filtrado

**-b\<servidor>** FTPhost--> Sirve para escanear un host desde otro, eso lo hace conect√°ndose el ftp de otra m√°quina y pidiendole que env√≠a archivos a los puertos que se quiera escanear de otra m√°quina, seg√∫n las respuestas sabremos si est√°n abiertos o no. \[\<usuario>:\<contrase√±a>@]\<servidor>\[:\<puerto>] Casi todos los servidores ftps ya no dejan hacer esto y por lo tanto ya tiene poca utilidad pr√°ctica,

**Centrar an√°lisis:**

**-p:** Sirve para dar los puertos a escanear. Para seleccionar los 65335: **-p-** o **-p all**. Nmap tiene una clasificaaci√≥n interna seg√∫n su popularidad. Por defecto usa los 1000 ppales. Con **-F** (fast scan) analiza los 100 ppales. Con **--top-ports \<numero>** Analiza ese numero de ppales (de 1 hasta los 65335). Comprueba los puertos en orden aleatorio, para que eso no pase **-r**. Tambi√©n podemos seleccionar puertos: 20-30,80,443,1024- Esto ultimo significa que mire en adelante del 1024. Tambi√©n podemos agrupar los puertos por protocolos: U:53,T:21-25,80,139,S:9. Tambi√©n podemos escoger un rango dentro de los puertos populares de nmap: -p \[-1024] analiza hasta el 1024 de los incluidos en nmap-services. **--port-ratio \<ratio>** Analiza los puertos m√°s com√∫nes que un ratio que debe estar entre 0 y 1

**-sV** Escaneado de versi√≥n, se puede regular la intensidad de 0 a 9, por defecto 7.

**--version-intensity \<numero>** Regulamos la intensidad, de forma que cuanto m√°s bajo solo lanzar√° las sondas m√°s probables, pero no todas. Con esto podemos acortar considerablemente el tiempo de escaneo UDP

**-O** Deteccion de os

**--osscan-limit** Para escanear bien un host se necesita que al menos haya 1 puerto abierto y otro cerrado, si no se da esta condici√≥n y hemos puesto esto, no intenta hacer predicci√≥n de os (ahorra tiempo)

**--osscan-guess** Cuando la detecci√≥n de os no es perfecta esto hace que se esfuerce m√°s

**Scripts**

\--script _\<filename>_|_\<category>_|_\<directory>_|_\<expression>_\[,...]

Para usar los de por efecto vale con -sC o --script=default

Los tipos que hay son de: auth, broadcast, default, discovery, dos, exploit, external, fuzzer, intrusive, malware, safe, version, and vuln

* **Auth:** ejecuta todos sus _scripts_ disponibles para autenticaci√≥n
* **Default:** ejecuta los _scripts_ b√°sicos por defecto de la herramienta
* **Discovery:** recupera informaci√≥n del _target_ o v√≠ctima
* **External:** _script_ para utilizar recursos externos
* **Intrusive:** utiliza _scripts_ que son considerados intrusivos para la v√≠ctima o _target_
* **Malware:** revisa si hay conexiones abiertas por c√≥digos maliciosos o _backdoors_ (puertas traseras)
* **Safe:** ejecuta _scripts_ que no son intrusivos
* **Vuln:** descubre las vulnerabilidades m√°s conocidas
* **All:** ejecuta absolutamente todos los _scripts_ con extensi√≥n NSE disponibles

Para buscar scripts:

&#x20;**nmap --script-help="http-\*" -> Los que empiecen por http-**

&#x20;**nmap --script-help="not intrusive" -> Todos menos esos**

&#x20;**nmap --script-help="default or safe" -> Los que estan en uno o en otro o en ambos**

&#x20;**nmap --script-help="default and safe" --> Los que estan en ambos**

&#x20;**nmap --script-help="(default or safe or intrusive) and not http-\*"**

\--script-args _\<n1>_=_\<v1>_,_\<n2>_={_\<n3>_=_\<v3>_},_\<n4>_={_\<v4>_,_\<v5>_}

\--script-args-file _\<filename>_

\--script-help _\<filename>_|_\<category>_|_\<directory>_|_\<expression>_|all\[,...]

\--script-trace ---> Da info de como va elscript

\--script-updatedb

**Para usar un script solo hay que poner: namp --script Nombre\_del\_script objetivo** --> Al poner el script se ejecutar√° tanto el script como el escaner, asi que tambien se pueden poner opciones del escaner, podemos a√±adir **‚Äúsafe=1‚Äù** para que se ejecuten solo los que sean seguros.

**Control tiempo**

**Nmap puede modificar el tiempo en segundos, minutos, ms:** --host-timeout arguments 900000ms, 900, 900s, and 15m all do the same thing.

Nmap divide el numero total de host a escanear en grupos y analiza esos grupos en bloques de forma que hasta que no han sido analizados todos, no pasa al siguiente bloque (y el usuario tampoco recibe ninguna actualizaci√≥n hasta que se haya analizado el bloque) de esta forma, es m√°s √≥ptimo para nmap usar grupos grandes. Por defecto en clase C usa 256.

Se puede cambiar con**--min-hostgroup** _**\<numhosts>**_**;** **--max-hostgroup** _**\<numhosts>**_ (Adjust parallel scan group sizes)

Se puede controlar el numero de escaners en paralelo pero es mejor que no (nmpa ya incorpora control automatico en base al estado de la red): **--min-parallelism** _**\<numprobes>**_**;** **--max-parallelism** _**\<numprobes>**_

Podemos modificar el rtt timeout, pero no suele ser necesario: **--min-rtt-timeout** _**\<time>**_**,** **--max-rtt-timeout** _**\<time>**_**,** **--initial-rtt-timeout** _**\<time>**_

Podemos modificar el numero de intentos:**--max-retries** _**\<numtries>**_

Podemos modificar el tiempo de escaneado de un host: **--host-timeout** _**\<time>**_

Podemos modificar el tiempo entre cada prueba para que vaya despacio: **--scan-delay** _**\<time>**_**;** **--max-scan-delay** _**\<time>**_

Podemos modificar el numero de paquetes por segundo: **--min-rate** _**\<number>**_**;** **--max-rate** _**\<number>**_

Muchos puertos tardan mucho en responder al estar filtrados o cerrados, si solo nos interesan los abiertos, podemos ir m√°s r√°pido con: **--defeat-rst-ratelimit**

Para definir lo agresivo que queremos que sea nmap: -T paranoid|sneaky|polite|normal|aggressive|insane

\-T (0-1)

\-T0 --> Solo se escanea 1 puerto a la vez y se espera 5min hasta el siguiente

\-T1 y T2 --> Muy parecidos pero solo esperan 15 y 0,4seg respectivamente enttre cada prueba

\-T3 --> Funcionamiento por defecto, incluye en paralelo

\-T4 --> --max-rtt-timeout 1250ms --min-rtt-timeout 100ms --initial-rtt-timeout 500ms --max-retries 6 --max-scan-delay 10ms

\-T5 --> --max-rtt-timeout 300ms --min-rtt-timeout 50ms --initial-rtt-timeout 250ms --max-retries 2 --host-timeout 15m --max-scan-delay 5ms

**Firewall/IDS**

No dejan pasar a puertos y analizan paquetes.

**-f** Para fragmentar paquetes, por defecto los fragmenta en 8bytes despu√©s de la cabecera, para especificar ese tama√±o usamos ..mtu (con esto, no usar -f), el offset debe ser multiplo de 8. **Escaners de version y scripts no soportan la fragmentacion**

**-D decoy1,decoy2,ME** Nmap envia escaneres pero con otras direcciones IPs como origen, de esta forma te esconden a ti. Si pones el ME en la lista, nmap te situara ahi, mejor poner 5 o 6 antes de ti para que te enmascaren completamente. Se pueden generar iPs aleatorias con RND:\<numero> Para generar \<numero> de Ips aleatorias. No funcionan con detector de versiones sin conexion de TCP. Si estas dentro de una red, te interesa usar Ips que esten activas, pues sino ser√° muy facil averiguar que tu eres la unica activa.

Para usar Ips aleatorias: nmap-D RND: 10 Ip\_objetivo

**-S IP** Para cuando Nmap no pilla tu direcci√≥n Ip se la tienes que dar con eso. Tambi√©n sirve para hacer pensar que hay otro objetivo escaneandoles.

**-e \<interface>** Para elegir la interfaz

Muchos administradores dejan puertos de entrada abiertos para que todo funcione correctamente y les es m√°s f√°cil que buscar otra soluci√≥n. Estos pueden ser los puertos DNS o los de FTP... para busca esta vulnerabilidad nmap incorpora: **--source-port** _**\<portnumber>**_**;-g** _**\<portnumber>**_ _Son equivalentes_

**--data** _**\<hex string>**_ Para enviar texto hexadecimal: --data 0xdeadbeef and --data \xCA\xFE\x09

**--data-string** _**\<string>**_ Para enviar un texto normal: --data-string "Scan conducted by Security Ops, extension 7192"

**--data-length** _**\<number>**_ Nmap env√≠a solo cabeceras, con esto logramos que a√±ada a estar un numero de bytes mas (que se generaran aleatoriamente)

Para configurar el paquete IP completamente usar **--ip-options**

If you wish to see the options in packets sent and received, specify --packet-trace. For more information and examples of using IP options with Nmap, see [http://seclists.org/nmap-dev/2006/q3/52](http://seclists.org/nmap-dev/2006/q3/52).

**--ttl** _**\<value>**_

**--randomize-hosts** Para que el ataque sea menos obvio

**--spoof-mac** _**\<MAC address, prefix, or vendor name>**_ Para cambiar la mac ejemplos: Apple, 0, 01:02:03:04:05:06, deadbeefcafe, 0020F2, and Cisco

**--proxies** _**\<Comma-separated list of proxy URLs>**_ Para usar proxies, a veces un proxy no mantiene tantas conexiones abiertas como nmap quiere por lo que habria que modificar el paralelismo: --max-parallelism

**-sP** Para descubrir host en la red en la que estamos por ARP

Muchos administradores crean una regla en el firewall que permite pasar todos los paquetes que provienen de un puerto en particular (como el 20,53 y 67), podemos decire a nmap que mande nuestros paquetes desde esos puertos: **nmap --source-port 53 Ip**

**Salidas**

**-oN file** Salida normal

**-oX file** Salida XML

**-oS file** Salida de script kidies

**-oG file** Salida grepable
=======
## NMAP Command Syntax

The syntax for an NMAP scan is as follows:

```
nmap [ <Scan Type> ] [ <Options> ] { <target specification> }
```
>>>>>>> master

* **Scan Type**: NMAP can perform different types of scans, e.g. TCP scan, UDP scan, SYN scan, etc.
* **Options**: NMAP scans can use additional options, e.g. OS Detection.
* **Target Specification**: the targets to be scanned by NMAP.

### NMAP Switches Cheat Sheet

Switches refer to the different scan options that can be set when using NMAP to scan a target machine. This cheat sheet shows the ones I personally use the most often and summarize their purpose.

```
--- MOST IMPORTANT SWITCH!!! ---nmap -h # Access NMAP Tool Manual--- Scan Types ---nmap -sS 192.168.176.133      # TCP SYN port scannmap -sT 192.168.176.133      # TCP connect port scannmap -sU 192.168.176.133      # UDP port scannmap -sA 192.168.176.133      # TCP ACK port scan--- Host Discovery ---nmap -Pn 192.168.176.133      # Disable Host Discovery (no ping)--- Port Specification ---nmap 192.168.176.133          # Scan 1000 most common portsnmap -p 80 192.168.176.133    # Scan port number specifiednmap -p- 192.168.176.133      # Scan all ports (65536)nmap -F 192.168.176.133       # Fast port scan--- Service & OS Detection ---nmap -sV 192.168.176.133      # Service version detectionnmap -O 192.168.176.133       # OS version detectionnmap -A 192.168.176.133       # Aggressive scan (OS detection,                                Service detection, script scanning,                                and traceroute) --- Timing ---nmap -T0 192.168.176.133     # Paranoid IDS evasionnmap -T1 192.168.176.133     # Sneaky IDS evasionnmap -T2 192.168.176.133     # Polite IDS evasionnmap -T3 192.168.176.133     # Normal IDS evasionnmap -T4 192.168.176.133     # Aggressive speed scannmap -T5 192.168.176.133     # Insane speed scan--- NSE Scripts --- nmap -sC 192.168.176.133     # Default most common scripts scannmap --script vuln 192.168.176.133 # Uses scripts from "vuln"                                     category--- NMAP Output Formats ---nmap -oN report 192.168.176.133 # Normal outputnmap -oG report 192.168.176.133 # Grepable outputnmap -oA report 192.168.176.133 # Output to all formats--- Verbosity ---nmap -v 192.168.176.133      # verbosity (Print Scan Progress)
```

A combination of these switches can be used to meet any requirements. The most common NMAP scan I perform for target machines is provided below as an example of combining multiple switches.

```
nmap -sV -sC -Pn -v -oN nmap_report 192.168.176.133
```

<<<<<<< HEAD
**--open** muestra los abiertos, abiertos|filtrados y los no filtrados
=======
The NMAP command above can be broken down as follows:
>>>>>>> master

* Scans the target machine for the 1000 most common ports.
* **-Pn**: Disables host discovery.
* **-Sv**: Performs version detection for the services.
* **-sC**: Performs a script scan using default scripts available in NMAP.
* **-v**: Provides verbose details about the NMAP scan.
* **-oN**: Outputs scan results to a file.

An example of what an NMAP scan output could look like can be seen below:

![.gitbook/assets/1664530416_7495.png](https://miro.medium.com/max/878/1\*zLM90hocyF0LZuP3awLM9Q.png)

Port 21 FTP Discovered

Based on the scan output above, NMAP has identified the following:

* **Port Number/Protocol**: 21/tcp
* **Port State**: open
* **Port Service**: ftp
* **Service Version**: vsftpd 3.0.3

### NMAP Port States

An NMAP scan returns the state of a port based on how NMAP sees it. These states are not intrinsic properties of the port itself. The port states can be categorized as seen below.

* **open**: application listening for connection on the port.
* **closed**: NMAP probes received but no application listening on the port.
* **filtered**: NMAP probes not received. Can indicate presence of firewall.
* **unfiltered**: NMAP unable to determine if port is open or closed.
* **open | filtered**: NMAP Unable to determine if a port is open or filtered.
* **closed | filtered**: NMAP Unable to determine if a port is closed or filtered.

Generally, the primary goal of an NMAP scan is to identify **open** ports, since they can provide an avenue for attack.

### NMAP Scripting Engine (NSE)

<<<<<<< HEAD
Script de nmap que mira las versiones de los servicios obtenidos en una base de datos offline (que descarga de otras muy importantes) y devuelve las posibles vulnerabilidades
=======
I want to finish this article with the NSE NMAP feature, since it can be quite powerful. The NSE was mentioned earlier with the ‚Äú-sC‚Äù and ‚Äú ‚Äî ‚Äî script‚Äù switches. The NSE scripts are categorized as follows:
>>>>>>> master

* **auth**: scripts deal with authentication credentials (or bypassing them), e.g. ftp anonymous login.
* **broadcast**: discovery of hosts not listed on the command line by broadcasting on the local network.
* **brute**: scripts use brute force attacks to guess authentication credentials, e.g. ‚Äúsnmp-brute‚Äù script.
* **default**: default scripts used with ‚Äú-sC‚Äù or ‚Äú-A‚Äù switch.
* **discover**: actively discover more about the network by querying public registries, SNMP-enabled devices, directory services, etc.
* **dos**: scripts cause a denial of service (DoS).
* **exploit**: scripts exploit some vulnerability, e.g. http-shellshock.
* **external**: scripts send data to a third-party database or other network resource, e.g. whois-ip lookup.
* **fuzzer**: scripts send server software unexpected or randomized fields in each packet, e.g. dns-fuzz script.
* **intrusive**: these scripts are considered very risky as they could crash the target system, e.g. snmp-brute script.
* **malware**: scripts test if target platform is infected by malware or backdoors.
* **safe**: scripts not designed to crash or damage systems.
* **version**: scripts only used when ‚Äú-sV‚Äù switch is used to detect service versions.
* **vuln**: scripts detect known vulnerabilities and generally only report their findings.

<<<<<<< HEAD
1. Scipvuldb.csv | [http://www.scip.ch/en/?vuldb](http://www.scip.ch/en/?vuldb)
2. Cve.csv | [http://cve.mitre.org](http://cve.mitre.org)
3. Osvdb.csv | [http://www.osvdb.org](http://www.osvdb.org)
4. Securityfocus.csv | [http://www.securityfocus.com/bid/](http://www.securityfocus.com/bid/)
5. Securitytracker.csv | [http://www.securitytracker.com](http://www.securitytracker.com)
6. Xforce.csv | [http://xforce.iss.net](http://xforce.iss.net)
7. Exploitdb.csv | [http://www.exploit-db.com](http://www.exploit-db.com)
8. Openvas.csv | [http://www.openvas.org](http://www.openvas.org)
=======
Taking advantage of these scripts can provide some very useful information when scanning a target. An example is shown below where an anonymous FTP Login has been discovered by using the ‚Äú-sC‚Äù switch when performing an NMAP scan.
>>>>>>> master

![.gitbook/assets/1664530416_7495.png](https://miro.medium.com/max/1198/1\*8bJ-UNPrt\_foLgL3P3L85A.png)

Anonymous FTP Login

### Closing Remarks

This guide is just a brief summary of the NMAP tool and some of it‚Äôs capabilities. I strongly recommend anyone looking to use this tool to read the manual and become familiar with its features and capabilities.

‚Äú _Give me six hours to chop down a tree and I will spend the first four sharpening the ax._ ‚Äù ‚Äî Abraham Lincoln

<<<<<<< HEAD
Para usar una BD espec√≠fica: sudo nmap -sV --script=vulscan --script-args vulscandb=cve.csv HOST\_A\_ESCANEAR
=======
The quote above can be used as a metaphor related to having a good understanding of your main tools, which will mean more accurate and efficient scans, with less time wasted. I hope you enjoyed this summary of the NMAP tool and found it useful. Feel free to follow me on Twitter (@TheTMC113) and happy scanning üòÉ!

![.gitbook/assets/1664530416_7495.png](https://miro.medium.com/max/1400/1\*7KvHCFjHO80Bh046TEhP\_w.jpeg)
>>>>>>> master
